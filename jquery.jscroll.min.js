/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging - v2.2.4
 * http://jscroll.com/
 *
 * Copyright 2011-2013, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * @author Philip Klauzinski
 * @requires jQuery v1.4.3+
 */
!function(t){t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1,onLoadComplete:!1}};var e=function(e,n){function l(){var e=t(p.loadingHtml).filter("img").attr("src");if(e){var n=new Image;n.src=e}}function r(){e.find(".jscroll-inner").length||e.contents().wrapAll('<div class="jscroll-inner" />')}function o(t){if(p.pagingSelector)var e=t.closest(p.pagingSelector).hide();else{var e=t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide();e.length||t.wrap('<div class="jscroll-next-parent" />').parent().hide()}}function i(){return b.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function a(){r();var t=e.find("div.jscroll-inner").first(),n=e.data("jscroll"),l=parseInt(e.css("borderTopWidth")),o=isNaN(l)?0:l,i=parseInt(e.css("paddingTop"))+o,a=j?b.scrollTop():e.offset().top,c=t.length?t.offset().top:0,s=Math.ceil(a-c+b.height()+i);return!n.waiting&&s+p.padding>=t.outerHeight()?(f("info","jScroll:",t.outerHeight()-s,"from bottom. Loading next request..."),d()):void 0}function c(t){return t=t||e.data("jscroll"),t&&t.nextHref?(s(),!0):(f("warn","jScroll: nextSelector not found - destroying"),i(),!1)}function s(){var t=e.find(p.nextSelector).first();return 0==t.length?!1:void(p.autoTrigger&&(p.autoTriggerUntil===!1||p.autoTriggerUntil>0)?(o(t),m.height()<=v.height()&&a(),b.unbind(".jscroll").bind("scroll.jscroll",function(){return a()}),p.autoTriggerUntil>0&&p.autoTriggerUntil--):(b.unbind(".jscroll"),t.bind("click.jscroll",function(){return o(t),d(),!1})))}function d(){var n=e.find("div.jscroll-inner").first(),l=e.data("jscroll");return l.waiting=!0,n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+p.loadingHtml+"</div>"),e.animate({scrollTop:n.outerHeight()},0,function(){n.find("div.jscroll-added").last().load(l.nextHref,function(n,r){if("error"===r)return i();p.onLoadComplete&&p.onLoadComplete.call(this,l.nextHref);var o=t(this).find(p.nextSelector).first();l.waiting=!1,l.nextHref=o.attr("href")?t.trim(o.attr("href")+" "+p.contentSelector):!1,t(".jscroll-next-parent",e).remove(),c(),p.callback&&p.callback.call(this),f("dir",l)})})}function f(t){if(p.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var e=[];for(var n in t)"function"==typeof console[n]?(e=t[n].length?t[n]:[t[n]],console[n].apply(console,e)):console.log.apply(console,e)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))}var u=e.data("jscroll"),g="function"==typeof n?{callback:n}:n,p=t.extend({},t.jscroll.defaults,g,u||{}),j="visible"===e.css("overflow-y"),h=e.find(p.nextSelector).first(),v=t(window),m=t("body"),b=j?v:e,x=t.trim(h.attr("href")+" "+p.contentSelector);return e.data("jscroll",t.extend({},u,{initialized:!0,waiting:!1,nextHref:x})),r(),l(),s(),t.extend(e.jscroll,{destroy:i}),e};t.fn.jscroll=function(n){return this.each(function(){var l=t(this),r=l.data("jscroll");if(!r||!r.initialized){new e(l,n)}})}}(jQuery);
