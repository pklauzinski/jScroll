/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging - v2.2.4
 * http://jscroll.com/
 *
 * Copyright 2011-2013, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * @author Philip Klauzinski
 * @requires jQuery v1.4.3+
 */
(function(e){e.jscroll={defaults:{debug:false,autoTrigger:true,autoTriggerUntil:false,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:false}};var t=function(t,n){function h(){var t=e(s.loadingHtml).filter("img").attr("src");if(t){var n=new Image;n.src=t}}function p(){if(!t.find(".jscroll-inner").length){t.contents().wrapAll('<div class="jscroll-inner" />')}}function d(e){if(s.pagingSelector){var t=e.closest(s.pagingSelector).hide()}else{var t=e.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide();if(!t.length){e.wrap('<div class="jscroll-next-parent" />').parent().hide()}}}function v(){return l.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function m(){p();var e=t.find("div.jscroll-inner").first(),n=t.data("jscroll"),r=parseInt(t.css("borderTopWidth")),i=isNaN(r)?0:r,u=parseInt(t.css("paddingTop"))+i,a=o?l.scrollTop():t.offset().top,f=e.length?e.offset().top:0,c=Math.ceil(a-f+l.height()+u);if(!n.waiting&&c+s.padding>=e.outerHeight()){w("info","jScroll:",e.outerHeight()-c,"from bottom. Loading next request...");return b()}}function g(e){e=e||t.data("jscroll");if(!e||!e.nextHref){w("warn","jScroll: nextSelector not found - destroying");v();return false}else{y();return true}}function y(){var n=t.find(s.nextSelector).first();if(s.autoTrigger&&(s.autoTriggerUntil===false||s.autoTriggerUntil>0||e.isFunction(s.autoTriggerUntil)&&s.autoTriggerUntil())){d(n);if(f.height()<=a.height()){m()}l.unbind(".jscroll").bind("scroll.jscroll",function(){return m()});if(s.autoTriggerUntil>0&&!e.isFunction(s.autoTriggerUntil)){s.autoTriggerUntil--}}else{l.unbind(".jscroll");n.bind("click.jscroll",function(){d(n);b();return false})}}function b(){var n=t.find("div.jscroll-inner").first(),r=t.data("jscroll");r.waiting=true;n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+s.loadingHtml+"</div>");return t.animate({scrollTop:n.outerHeight()},0,function(){n.find("div.jscroll-added").last().load(r.nextHref,function(n,i,o){if(i==="error"){return v()}var u=e(this).find(s.nextSelector).first();r.waiting=false;r.nextHref=u.attr("href")?e.trim(u.attr("href")+" "+s.contentSelector):false;e(".jscroll-next-parent",t).remove();g();if(s.callback){s.callback.call(this)}w("dir",r)})})}function w(e){if(s.debug&&typeof console==="object"&&(typeof e==="object"||typeof console[e]==="function")){if(typeof e==="object"){var t=[];for(var n in e){if(typeof console[n]==="function"){t=e[n].length?e[n]:[e[n]];console[n].apply(console,t)}else{console.log.apply(console,t)}}}else{console[e].apply(console,Array.prototype.slice.call(arguments,1))}}}var r=t.data("jscroll"),i=typeof n==="function"?{callback:n}:n,s=e.extend({},e.jscroll.defaults,i,r||{}),o=t.css("overflow-y")==="visible",u=t.find(s.nextSelector).first(),a=e(window),f=e("body"),l=o?a:t,c=e.trim(u.attr("href")+" "+s.contentSelector);t.data("jscroll",e.extend({},r,{initialized:true,waiting:false,nextHref:c}));p();h();y();e.extend(t.jscroll,{destroy:v});return t};e.fn.jscroll=function(n){return this.each(function(){var r=e(this),i=r.data("jscroll");if(i&&i.initialized)return;var s=new t(r,n)})}})(jQuery)