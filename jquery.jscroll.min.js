/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging
 * http://jscroll.com/
 *
 * Copyright 2011-2013, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * @author Philip Klauzinski
 * @version 2.3.1
 * @requires jQuery v1.4.3+
 * @preserve
 */
!function(t){"use strict";t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var e=function(e,n){var r=e.data("jscroll"),l="function"==typeof n?{callback:n}:n,o=t.extend({},t.jscroll.defaults,l,r||{}),i="visible"===e.css("overflow-y"),a=e.find(o.nextSelector).first(),c=t(window),s=t("body"),d=i?c:e,f=a.attr("href")?t.trim(a.attr("href")+" "+o.contentSelector):!1,u=Math.floor(1e4*Math.random()+1),g=function(){var e=t(o.loadingHtml).filter("img").attr("src");if(e){var n=new Image;n.src=e}},p=function(){e.find(".jscroll-inner").length||e.contents().wrapAll('<div class="jscroll-inner" />')},j=function(t){var e;o.pagingSelector?t.closest(o.pagingSelector).hide():(e=t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide(),e.length||t.wrap('<div class="jscroll-next-parent" />').parent().hide())},h=function(){d.unbind(".jscroll"+u),e.removeData("jscroll"),e.find(".jscroll-inner").children().unwrap(),e.filter(".jscroll-added").children().unwrap(),e.find(".jscroll-loading").remove()},v=function(){p();var t=e.find("div.jscroll-inner").first(),n=e.data("jscroll"),r=parseInt(e.css("borderTopWidth"),10),l=isNaN(r)?0:r,a=parseInt(e.css("paddingTop"),10)+l,c=i?d.scrollTop():e.offset().top,s=t.length?t.offset().top:0,f=Math.ceil(c-s+d.height()+a);return!n.waiting&&t.outerHeight()>0&&f+o.padding>=t.outerHeight()?(y("info","jScroll:",t.outerHeight()-f,"from bottom. Loading next request..."),x()):void 0},b=function(t){return t=t||e.data("jscroll"),t&&t.nextHref?(m(),!0):(y("warn","jScroll: nextSelector not found - destroying"),h(),!1)},m=function(){var t=e.find(o.nextSelector).first();o.autoTrigger&&(o.autoTriggerUntil===!1||o.autoTriggerUntil>0)?(j(t),s.height()<=c.height()&&v(),d.unbind(".jscroll"+u).bind("scroll.jscroll"+u,function(){return v()}),o.autoTriggerUntil>0&&o.autoTriggerUntil--):(d.unbind(".jscroll"+u),t.bind("click.jscroll"+u,function(){return j(t),x(),!1}))},x=function(){var n=e.find("div.jscroll-inner").first(),r=e.data("jscroll");return r.waiting=!0,n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+o.loadingHtml+"</div>"),e.animate({scrollTop:n.outerHeight()},0,function(){n.find("div.jscroll-added").last().load(r.nextHref,function(n,l){if("error"===l)return h();var i=t(this).find(o.nextSelector).first();r.waiting=!1,r.nextHref=i.attr("href")?t.trim(i.attr("href")+" "+o.contentSelector):!1,t(".jscroll-next-parent",e).remove(),b(),o.callback&&o.callback.call(this),y("dir",r)})})},y=function(t){if(o.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var e=[];for(var n in t)"function"==typeof console[n]?(e=t[n].length?t[n]:[t[n]],console[n].apply(console,e)):console.log.apply(console,e)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};return e.data("jscroll",t.extend({},r,{initialized:!0,waiting:!1,nextHref:f,unique_id:u})),p(),g(),m(),b(),t.extend(e.jscroll,{destroy:h}),e};t.fn.jscroll=function(n){return this.each(function(){var r,l=t(this),o=l.data("jscroll");o&&o.initialized||(r=new e(l,n))})}}(jQuery);
